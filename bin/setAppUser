#!/bin/sh

## CHECK ENV VAR
[ -n "$APP_USER" 	] || ( echo "[ENV] APP_USER is empty"; 	exit 1 )
[ -n "$APP_UID" 	] || ( echo "[ENV] APP_UID is empty"; 	exit 1 )
[ -n "$APP_GROUP" ] || ( echo "[ENV] APP_GROUP is empty"; exit 1 )
[ -n "$APP_GUID" 	] || ( echo "[ENV] APP_GUID is empty"; 	exit 1 )

## CREATE GROUP
if id -g "$APP_GROUP" ;then
	printf "\nGroup %s already exists!" "$APP_GROUP"
	exit 2
elif id -g "$APP_GUID"; then
	printf "\nGroup %s already exists!" "$APP_GUID"
	exit 2
else
	addgroup -g "${APP_GUID}" -S "${APP_GROUP}" || exit 3
fi

## CREATE USER
if id "$APP_USER" ; then
	printf "\nUser %s already exists!" "$APP_USER"
	exit 4
elif id "$APP_UID" ; then
	printf "\nUser %s already exists!" "$APP_UID"
	exit 4
else
	adduser  -u "${APP_UID}" -S -D -s /bin/ash -G "${APP_GROUP}" -h "/var/run/${APP_USER}" "${APP_USER}" || exit 5
fi

